const { writeFileSync } = require("fs");

module.exports.config = {
  name: "Obot",
  version: "1.0.0",
  hasPermssion: 0,
  credits: "Shuvo",
  description: "Full-featured chat bot with commands, replies, and quiz",
  commandCategory: "Noprefix",
  usages: "noprefix",
  cooldowns: 5,
};

// -------------------------
// ржбрзЗржЯрж╛ ржПржХрзНрж╕рзЗрж╕ ржХрж░рж╛рж░ ржЬржирзНржп single object
// -------------------------
const data = {
  textReplies: [
    { trigger: "рж╣рж╛ржЗ", response: "рж╣рзНржпрж╛рж▓рзЛ! ржХрзЗржоржи ржЖржЫрзЛ?" },
    { trigger: "ржХрзЗржоржи ржЖржЫрзЛ", response: "ржнрж╛рж▓рзЛ, рждрзБржорж┐ ржХрзЗржоржи?" },
    { trigger: "рж╢рзБржн рж╕ржХрж╛рж▓", response: "рж╢рзБржн рж╕ржХрж╛рж▓! ржЖржЬржХрзЗрж░ ржжрж┐ржи рж╕рзБржирзНржжрж░ рж╣рзЛржХред" },
    { trigger: "рж╢рзБржн рж░рж╛рждрзНрж░рзА", response: "рж╢рзБржн рж░рж╛рждрзНрж░рзА! ржорж┐рж╖рзНржЯрж┐ рж╕рзНржмржкрзНржи ржжрзЗржЦрзЛред" },
    { trigger: "ржзржирзНржпржмрж╛ржж", response: "рж╕рзНржмрж╛ржЧрждржо!" },
    { trigger: "ржХрзЛржерж╛ржпрж╝ ржпрж╛ржЪрзНржЫ?", response: "ржЖржорж┐ рждрзЛржорж╛рж░ рж╕рж╛ржерзЗ ржЖржЫрж┐ред" },
    { trigger: "ржХрж┐ ржХрж░ржЫ?", response: "рждрзЛржорж╛рж░ ржЬржирзНржп ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░ржЫрж┐ред" },
    { trigger: "ржнрж╛рж▓рзЛ рж▓рж╛ржЧржЫрзЗ", response: "ржЖржорж╛рж░ржУ ржнрж╛рж▓рзЛ рж▓рж╛ржЧржЫрзЗ!" },
    { trigger: "ржоржЬрж╛ ржХрж░ржЫ?", response: "рж╣рзНржпрж╛ржБ, ржПржХржЯрзБ ржоржЬрж╛ ржХрж░рж┐!" },
    { trigger: "ржнрж╛рж▓рзЛ", response: "ржжрж╛рж░рзБржг!" },
    { trigger: "ржЦрж╛рж░рж╛ржк", response: "ржжрзБржГржЦрж┐ржд рж╢рзБржирзЗред" },
    { trigger: "ржмржирзНржзрзБ", response: "рж╣рзНржпрж╛ржБ ржмржирзНржзрзБ, ржХрзЗржоржи ржЖржЫрзЛ?" },
    { trigger: "рждрзБржорж┐ ржХрзЗ?", response: "ржЖржорж┐ Shuvo ржмржЯред" },
    { trigger: "ржЪрж╛ ржЦрж╛ржмрзЗ?", response: "ржЖржорж┐ ржЪрж╛ ржЦрж╛ржЗ ржирж╛, ржХрж┐ржирзНрждрзБ рждрзЛржорж╛рж░ рж╕рж╛ржерзЗ ржЖржЫрж┐ред" },
    { trigger: "ржЦрж┐ржжрзЗ рж▓рзЗржЧрзЗржЫрзЗ", response: "ржХрж┐ржЫрзБ ржЦрж╛ржУржпрж╝рж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзЛред" },
    { trigger: "ржмрзЛрж░ рж▓рж╛ржЧржЫрзЗ", response: "ржЪрж▓ ржЧрж▓рзНржк ржХрж░рж┐ред" },
    { trigger: "ржЧрзЗржо ржЦрзЗрж▓ржм?", response: "рж╣рзНржпрж╛ржБ, ржХрзЛржи ржЧрзЗржо ржЦрзЗрж▓ржмрж┐?" },
    { trigger: "рж╕рж┐ржирзЗржорж╛ ржжрзЗржЦржм?", response: "ржЪрж▓ ржжрзЗржЦрж┐, ржХрзЛржиржЯрж╛ ржжрзЗржЦржм?" },
    { trigger: "ржХрзЛржи ржЦржмрж░?", response: "рж╕ржм ржЦржмрж░ ржарж┐ржХ ржЖржЫрзЗред" },
    { trigger: "ржмрзГрж╖рзНржЯрж┐ рж╣ржЪрзНржЫрзЗ?", response: "рж╣рзНржпрж╛ржБ, ржЫрж╛рждрж╛ ржирж╛ржУред" },
    { trigger: "рж╢рзАржд рж▓рж╛ржЧржЫрзЗ", response: "ржХржорзНржмрж▓ ржирж╛ржУред" },
    { trigger: "ржЧрж░ржо рж▓рж╛ржЧржЫрзЗ", response: "ржкрж╛ржирж┐ ржЦрж╛ржУред" },
    { trigger: "ржХрзЛржи ржЧрж╛ржи ржЪрж▓ржЫрзЗ?", response: "ржЖржорж┐ ржЧрж╛ржи рж╢рзБржирждрзЗ ржкрж╛рж░рж┐ ржирж╛, ржХрж┐ржирзНрждрзБ рждрзЛржорж╛рж░ ржкржЫржирзНржжрзЗрж░ ржЧрж╛ржи ржмрж╛ржЬрж╛ржУред" },
    { trigger: "ржоржЬрж╛рж░ ржХржерж╛ ржмрж▓рзЛ", response: "ржПржХржЯрж┐ ржХрзМрждрзБржХ: ржХрзЗржи ржХржорзНржкрж┐ржЙржЯрж╛рж░ ржарж╛ржирзНржбрж╛? ржХрж╛рж░ржг рж╕рзЗ ржЙржЗржирзНржбрзЛ ржЦрзБрж▓рзЗржЫрзЗ!" }
  ],
  commands: [
    { name: "help", description: "рж╕ржм ржХржорж╛ржирзНржбрзЗрж░ рж▓рж┐рж╕рзНржЯ ржжрзЗржЦрж╛ржмрзЗ" },
    { name: "quiz", description: "ржХрзБржЗржЬ ржЦрзЗрж▓рж╛рж░ ржЬржирзНржп ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЛ" }
  ],
  quiz: [
    { topic: "general", question: "ржмрж╛ржВрж▓рж╛ржжрзЗрж╢рзЗрж░ рж░рж╛ржЬржзрж╛ржирзА ржХрзЛржерж╛ржпрж╝?" },
    { topic: "general", question: "ржкрзГржерж┐ржмрзАрж░ рж╕ржмржЪрзЗржпрж╝рзЗ ржмржбрж╝ ржорж╣рж╛рж╕рж╛ржЧрж░ ржХрзЛржиржЯрж┐?" },
    { topic: "science", question: "ржкрж╛ржирж┐ ржХрж┐ рж░рж╛рж╕рж╛ржпрж╝ржирж┐ржХ рж╕рзВрждрзНрж░рзЗ ржХрж┐ рж▓рзЗржЦрж╛ рж╣ржпрж╝?" }
  ]
};

// -------------------------
// Event рж╣рзНржпрж╛ржирзНржбрж▓
// -------------------------
module.exports.handleEvent = async function({ api, event, Users }) {
  const { threadID, senderID, body } = event;
  const msgLower = body.toLowerCase();
  let name = await Users.getNameUser(senderID);

  // -------------------------
  // рзз) Text replies
  // -------------------------
  for (let reply of data.textReplies) {
    if (msgLower === reply.trigger.toLowerCase()) {
      return api.sendMessage(reply.response, threadID);
    }
  }

  // -------------------------
  // рзи) /help ржХржорж╛ржирзНржб
  // -------------------------
  if (msgLower === "/help") {
    let helpMsg = "ЁЯТ╗ ржХржорж╛ржирзНржб рж▓рж┐рж╕рзНржЯ:\n\n";
    data.commands.forEach(cmd => {
      helpMsg += `/${cmd.name} - ${cmd.description}\n`;
    });
    return api.sendMessage(helpMsg, threadID);
  }

  // -------------------------
  // рзй) /quiz ржХржорж╛ржирзНржб
  // -------------------------
  if (msgLower.startsWith("/quiz")) {
    let topic = msgLower.split(" ")[1] || "general";
    let filteredQuiz = data.quiz.filter(q => q.topic === topic);
    if (!filteredQuiz.length) return api.sendMessage("ржПржЗ ржЯржкрж┐ржХрзЗрж░ ржХрзБржЗржЬ ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐ ЁЯШЕ", threadID);

    let questionObj = filteredQuiz[Math.floor(Math.random() * filteredQuiz.length)];
    return api.sendMessage(`ЁЯУЭ ржХрзБржЗржЬ: ${questionObj.question}\nрж╕ржорж╛ржзрж╛ржирзЗрж░ ржЬржирзНржп рж╕ржорзЯ: 10 рж╕рзЗржХрзЗржирзНржб`, threadID);
  }

  // -------------------------
  // рзк) TikTok рж▓рж┐ржЩрзНржХ рж╣рзНржпрж╛ржирзНржбрж▓
  // -------------------------
  if (msgLower.includes("tiktok.com")) {
    return api.sendMessage(`ЁЯОе TikTok ржнрж┐ржбрж┐ржУ рж▓рж┐ржЩрзНржХ ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛ржХрзГржд: ${body}`, threadID);
  }
};

module.exports.run = function({ api, event, client, __GLOBAL }) {};
